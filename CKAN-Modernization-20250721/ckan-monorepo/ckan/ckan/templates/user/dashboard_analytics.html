{% extends "user/dashboard.html" %}

{% block page_primary_action %}
  <!-- No primary action for analytics -->
{% endblock %}

{% block primary_content_inner %}
  <div class="analytics-dashboard">
    <div class="analytics-header">
      <h2>Analytics Dashboard</h2>
      <p class="analytics-subtitle">CKAN Usage Insights for the last {{ days }} days</p>
      
      <div class="analytics-controls">
        <label for="time-period">Time Period:</label>
        <select id="time-period" name="days" onchange="this.form.submit()">
          <option value="7" {% if days == 7 %}selected{% endif %}>Last 7 days</option>
          <option value="30" {% if days == 30 %}selected{% endif %}>Last 30 days</option>
          <option value="90" {% if days == 90 %}selected{% endif %}>Last 90 days</option>
          <option value="365" {% if days == 365 %}selected{% endif %}>Last year</option>
        </select>
      </div>
    </div>

    <div class="analytics-metrics">
      <div class="metrics-grid">
        <div class="metric-card metric-primary">
          <div class="metric-number">{{ event_counts.get('search', 0) }}</div>
          <div class="metric-label">Searches</div>
        </div>
        
        <div class="metric-card metric-secondary">
          <div class="metric-number">{{ event_counts.get('dataset_view', 0) }}</div>
          <div class="metric-label">Dataset Views</div>
        </div>
        
        <div class="metric-card metric-info">
          <div class="metric-number">{{ total_events }}</div>
          <div class="metric-label">Total Events</div>
        </div>
        
        <div class="metric-card metric-success">
          <div class="metric-number">{{ event_counts.get('download', 0) }}</div>
          <div class="metric-label">Downloads</div>
        </div>
      </div>
    </div>

    <div class="analytics-chart">
      <h3>Daily Activity</h3>
      <div class="chart-placeholder">
        <p>Chart data: {{ chart_data | length }} data points</p>
      </div>
    </div>

    {% if popular_datasets %}
    <div class="popular-datasets">
      <h3>Popular Datasets</h3>
      <div class="dataset-list">
        {% for dataset in popular_datasets[:5] %}
          <div class="dataset-item">
            <a href="/dataset/{{ dataset.name }}">{{ dataset.title or dataset.name }}</a>
            <span class="view-count">{{ dataset.view_count }} views</span>
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% if search_terms %}
    <div class="search-terms">
      <h3>Popular Search Terms</h3>
      <div class="search-list">
        {% for term in search_terms[:10] %}
          <span class="search-term">{{ term.query }} ({{ term.count }})</span>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>

  <style>
    .analytics-dashboard { margin: 20px 0; }
    .analytics-header { margin-bottom: 30px; }
    .analytics-subtitle { color: #666; margin-bottom: 20px; }
    .analytics-controls { margin-bottom: 20px; }
    .analytics-controls select { padding: 5px 10px; }
    
    .metrics-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
      gap: 20px; 
      margin-bottom: 30px; 
    }
    
    .metric-card { 
      background: white; 
      padding: 20px; 
      border-radius: 8px; 
      text-align: center; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
    }
    
    .metric-number { 
      font-size: 2.5em; 
      font-weight: bold; 
      margin-bottom: 10px; 
    }
    
    .metric-primary .metric-number { color: #3498db; }
    .metric-secondary .metric-number { color: #e91e63; }
    .metric-info .metric-number { color: #9c27b0; }
    .metric-success .metric-number { color: #4caf50; }
    
    .analytics-chart { 
      background: white; 
      padding: 20px; 
      border-radius: 8px; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
      margin-bottom: 30px; 
    }
    
    .popular-datasets, .search-terms { 
      background: white; 
      padding: 20px; 
      border-radius: 8px; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
      margin-bottom: 20px; 
    }
    
    .dataset-item { 
      display: flex; 
      justify-content: space-between; 
      padding: 10px 0; 
      border-bottom: 1px solid #eee; 
    }
    
    .search-term { 
      display: inline-block; 
      background: #f0f0f0; 
      padding: 5px 10px; 
      margin: 5px; 
      border-radius: 15px; 
      font-size: 0.9em; 
    }
  </style>


{% endblock %} 